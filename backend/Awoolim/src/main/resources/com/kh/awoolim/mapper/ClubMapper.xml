<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.awoolim.mapper.ClubMapper">

	<insert id="create" parameterType="com.kh.awoolim.domain.Club">
		INSERT INTO CLUB VALUES(
		club_seq.nextVal,#{clubTitle},#{clubGender},
		#{ageLimit},#{category},#{city}
		,#{district},#{regularType},#{maxMember}
		,#{userId},#{dDay},#{clubImage}
		,#{detailInfo},#{recruitment},#{memberCount})
	</insert>

	<select id="readClub" resultType="com.kh.awoolim.domain.Club" parameterType="int">
		SELECT *
		FROM CLUB WHERE CLUBNO = #{clubNo}
	</select>

	<select id="readPopularTop4" resultType="com.kh.awoolim.domain.Club">
		SELECT * FROM CLUB ORDER
		BY MEMBERCOUNT DESC,CLUBNO ASC
		FETCH FIRST 4 ROWS
		ONLY
	</select>
	<select id="clubCount" resultType="int">
		SELECT COUNT(CLUBNO) FROM CLUB
		WHERE USERID = #{userId}
	</select>
	<select id="readMyApprovalClubList" parameterType="int"
		resultType="com.kh.awoolim.domain.Club">
		SELECT c.* FROM
		CLUB c JOIN CLUBMEMBER cm
		ON c.CLUBNO =
		cm.CLUBNO
		WHERE cm.USERID = #{userId} AND c.USERID != #{userId} AND
		cm.ISACCEPT = 1
	</select>
	<select id="readMyClubDisapprovalList" parameterType="int"
		resultType="com.kh.awoolim.domain.Club">
		SELECT c.* FROM
		CLUB c JOIN CLUBMEMBER cm
		ON c.CLUBNO =
		cm.CLUBNO
		WHERE cm.USERID = #{userId} AND c.USERID != #{userId} AND
		cm.ISACCEPT = 0
	</select>
	<update id="addClubCount" parameterType="int">
		UPDATE CLUB SET
		MEMBERCOUNT = MEMBERCOUNT + 1
		WHERE CLUBNO = #{clubNo}
	</update>
	<update id="minusClubCount" parameterType="int">
		UPDATE CLUB SET
		MEMBERCOUNT = MEMBERCOUNT - 1
		WHERE CLUBNO = #{clubNo}
	</update>
	<select id="readMyMadeClubList" parameterType="int"
		resultType="com.kh.awoolim.domain.Club">
		SELECT * FROM CLUB WHERE USERID = #{userId}
	</select>
	<update id="modifyClub" parameterType="com.kh.awoolim.domain.Club">
		UPDATE CLUB SET CLUBTITLE
		= #{clubTitle},CATEGORY = #{category},
		CLUBGENDER = #{clubGender}, DDAY
		= #{dDay}, REGULARTYPE = #{regularType},
		MAXMEMBER = #{maxMember}, CITY
		= #{city}, DISTRICT = #{district},
		DETAILINFO = #{detailInfo}, AGELIMIT
		= #{ageLimit}, CLUBIMAGE = #{clubImage},
		RECRUITMENT = #{recruitment}
		WHERE CLUBNO = #{clubNo}
	</update>
	<select id="getAllClubs" resultType="com.kh.awoolim.domain.Club">
		SELECT * FROM club
		ORDER BY CLUBNO ASC
	</select>

	<select id="searchClubs" resultType="com.kh.awoolim.domain.Club" parameterType="java.util.Map">
		SELECT * FROM CLUB
		where clubTitle like '%' || #{clubTitle} || '%'
		<if test="city != null and city != ''">
			AND city = #{city}
		</if>
		<if test="district != null and district != ''">
			AND district = #{district}
		</if>
		<if test="clubGender != null and clubGender != ''">
			AND CLUBGENDER = #{clubGender}
		</if>
		<if test="regularType != null and regularType != ''">
			AND REGULARTYPE = #{regularType}
		</if>
		<if test="category != null and category != ''">
			AND CATEGORY = #{category}
		</if>
	</select>
	
	<delete id="delete" parameterType="int">
		DELETE FROM CLUB
		WHERE CLUBNO =
		#{clubNo}
	</delete>

</mapper>

